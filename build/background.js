"use strict";let r="http://cloud-beta-wan.ludashi.com/console";const u={getUnreadMsgNum:e=>{e.url=r+"/MessageTotal",e.method="get",n(e)},getMsgList:e=>{e.url=r+"/MessageLists",n(e)},markMsgRead:e=>{e.url=r+"/MessageRead",e.method="get",n(e)}};function n(e){e.background?i(e):d(e)}function d(e){console.log("config: ",e),e.data===void 0&&(e.data={}),e.method=e.method||"post";let t={},a=null;e.formData?(a=new FormData,Object.keys(e.data).forEach(function(s){a.append(s,e.data[s])})):(t["Content-Type"]="application/json;charset=UTF-8",a=JSON.stringify(e.data)),e.method,e.url.indexOf("/MessageLists")>-1&&e.success({errno:0,msg:"succ",data:{lists:[{title:"计划A费用超标 11111",id:1},{title:"计划A费用超标 2",id:1},{title:"计划A费用超标 3",id:1},{title:"计划A费用超标 4",id:1},{title:"计划A费用超标 1",id:1},{title:"计划A费用超标 2",id:1},{title:"计划A费用超标 3",id:1},{title:"计划A费用超标 4",id:1}],limit:10,currentPage:1,totalPage:1}}),e.url.indexOf("/MessageTotal")>-1&&e.success({errno:0,msg:"succ",data:{total:20}})}function i(e){chrome&&chrome.runtime?chrome.runtime.sendMessage({type:"apiRequest",config:e},t=>{e.done&&e.done(),t.result==="succ"?e.success&&e.success(t):e.fail&&e.fail(t.msg)}):console.log("未找到chrome API")}chrome.runtime.onInstalled.addListener(function(){chrome.action.disable(),chrome.declarativeContent.onPageChanged.removeRules(void 0,()=>{const t=[{conditions:[new chrome.declarativeContent.PageStateMatcher({pageUrl:{hostSuffix:".juejin.cn"}})],actions:[new chrome.declarativeContent.ShowAction]}];chrome.declarativeContent.onPageChanged.addRules(t)}),setInterval(()=>{u.getUnreadMsgNum({data:{user_name:"zhanghengpu"},success:e=>{console.log("未读消息数获取成功",e),console.log(e.data.total),chrome.action.setBadgeText({text:String(e.data.total)}),chrome.action.setBadgeBackgroundColor({color:[255,0,0,255]})},fail:e=>{console.log("未读消息数获取失败",e)}})},2e3),console.log(111),console.log(222)});chrome.runtime.onMessage.addListener(function(e,t,a){return chrome.tabs.query({currentWindow:!0,active:!0},function(){const{type:s}=e;if(s==="apiRequest"){let{config:l}=e;l.success=o=>{o.result="succ",a(o)},l.fail=o=>{a({result:"fail",msg:o})},d(l)}}),!0});
