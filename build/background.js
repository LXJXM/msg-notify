"use strict";const s="http://admin-aliyun-test.ludashi.com/",d="网络连接异常，请稍后再试";function l(e){console.log("config: ",e),e.data===void 0&&(e.data={}),e.method=e.method||"post";let a={},t=null;e.formData?(t=new FormData,Object.keys(e.data).forEach(function(o){t.append(o,e.data[o])})):(a["Content-Type"]="application/json;charset=UTF-8",t=JSON.stringify(e.data));let n={method:e.method,headers:a,body:t};fetch(e.url,n).then(o=>o.json()).then(o=>{e.done&&e.done(),e.success&&e.success(o)}).catch(()=>{e.done&&e.done(),e.fail&&e.fail(d)})}let u=null;chrome.runtime.onInstalled.addListener(function(){console.log("插件 安装！")});chrome.runtime.onStartup.addListener(function(){console.log("插件 启动！")});chrome.runtime.onMessage.addListener(function(e,a,t){return chrome.tabs.query({currentWindow:!0,active:!0},function(){const{type:n}=e;if(n==="apiRequest"){let{config:o}=e;o.success=r=>{r.result="succ",t(r)},o.fail=r=>{t({result:"fail",msg:r})},l(o)}}),!0});chrome.runtime.onMessage.addListener((e,a,t)=>{if(e.type=="initPopup")return t({userInfo:u}),!0;if(e.type=="updateBadgeText")return e.text>0?chrome.action.setBadgeText({text:e.text.toString()}):chrome.action.setBadgeText({text:""}),!0});chrome.tabs.onUpdated.addListener(function(e,a,t){a.status==="complete"&&t.active&&(console.log("tab updataed!"),console.log("main url: ",s),chrome.cookies.get({url:s,name:"LUP"},n=>{console.log("background res:",n),n&&n.value?u=decodeURIComponent(n.value):u=null,console.log("backround userInfo:",u)}))});
